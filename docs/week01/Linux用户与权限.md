# Linux用户与权限

## 配置文件

用户信息文件(/etc/passwd)以`:`来分隔7个字段：

* 用户名
* 密码占位符（`x`表示用户需要密码登录）
* 用户标识号（UID,500以上为建立的用户，其余为系统用户）
* 组标识号（GID）
* 注释性描述
* 主目录
* 登录的shell

密码文件(/etc/shadow)以`:`来分隔字段：

* 用户名
* 加密口令
* 最后一次修改时间
* 密码最短有效天数
* 密码最长有效天数
* 密码过期前的警告时间
* 不活动时间
* 用户失效时间
* 暂时保留未使用

读取/etc/shadow需要sudo

用户组文件(/etc/group)以`:`来分隔字段：

* 组名
* 口令
* 组标识号（GID）
* 组内用户列表（多用户可用逗号分隔开）

## 用户管理

`useradd`命令可以添加用户:

* `-d` 指定家目录（`-m`创建家目录）
* `-s` 指定登录Shell
* `-g` 指定用户组
* `-G` 附加用户组

*adduser命令也可以添加用户*

`passwd`命令可以管理密码：

* `sudo passwd xxx` 设置用户xxx的密码
* `-d` 删除密码
* `-l` 锁定账户(会在/etc/shadow中加密的密码前加`!`)  `-u` 解除账户锁定
* `-S` 查看密码状态（密码状态中，P为设置了密码，NP为没有设置密码）

`usermod`命令可以修改用户信息，主要选项和`useradd`相同。

* `-a` 添加附加组
* `-L` 锁定用户

`userdel`删除用户。`-r`将该用户的家目录也移除。

* `w` 查看当前用户
* `who` 查看主机上的用户
* `lastlog` 查看登录记录
* `id` 查看用户id和组信息

批量创建用户：

* 以/etc/passwd的格式书写新用户，将内容传给`sudo newusers`
* `sudo pwunconv`关闭影子文件（/etc/shadow）
* 以 用户名:密码 的格式书写，将内容传给`sudo chpasswd`
* `sudo pwconv`恢复影子文件

`groupadd`新增用户组：

* `-g` 指定组标识号（GID）
* `-o` 与`-g`同时使用，允许用户组的新GID和系统已有的用户组的相同

`groupmod`修改用户组，参数和`groupadd`类似。`-n`可以重命名用户组

`groupdel`删除用户组

`groups`可以查看用户的用户组
